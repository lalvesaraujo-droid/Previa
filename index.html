<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prévia</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{
  margin:0;
  font-family:Inter, sans-serif;
  background:linear-gradient(180deg,#0f2a44,#1e3f66);
  color:#fff;
}
.container{
  max-width:520px;
  margin:auto;
  padding:20px;
}
h1{margin:0 0 5px 0}
.card{
  background:#ffffff15;
  backdrop-filter:blur(10px);
  border-radius:18px;
  padding:18px;
  margin:14px 0;
}
input, textarea, select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:8px;
  margin-bottom:12px;
  font-size:15px;
}
textarea{min-height:70px}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:600;
  margin-top:10px;
}
.btn-primary{background:#22c55e;color:white}
.btn-secondary{background:#3b82f6;color:white}
.btn-clear{background:#ffffff30;color:white;width:48%;display:inline-block}
.sig{
  background:white;
  border-radius:12px;
  height:140px;
}
</style>
</head>

<body>
<div class="container">

<h1>Prévia</h1>
<div style="opacity:.8;margin-bottom:18px">
plataforma de avaliação pré-anestésica<br>
Dr Leonardo Alves Araújo · CRM-MG 47310 · RQE 40542
</div>

<!-- ETAPA 1 -->
<div class="card">
<h3>Identificação</h3>
<select id="modo">
<option>Clínica / Hospital</option>
<option>Estética</option>
</select>
<input id="nome" placeholder="Nome do paciente">
<input id="proc" placeholder="Procedimento">
<input id="asa" placeholder="ASA">
<input id="mallampati" placeholder="Mallampati">
</div>

<!-- ETAPA 2 -->
<div class="card">
<h3>Comorbidades</h3>
<textarea id="comorb" placeholder="Doenças e condições"></textarea>
</div>

<!-- ETAPA 3 -->
<div class="card">
<h3>Medicações e alergias</h3>
<textarea id="medic" placeholder="Medicações"></textarea>
<textarea id="alerg" placeholder="Alergias"></textarea>
</div>

<!-- ETAPA 4 -->
<div class="card">
<h3>Histórico anestésico</h3>
<textarea id="cirurg" placeholder="Passado cirúrgico"></textarea>
<textarea id="interc" placeholder="Intercorrências anestésicas"></textarea>
</div>

<!-- ETAPA 5 -->
<div class="card">
<h3>Plano anestésico</h3>
<textarea id="estrat" placeholder="Estratégia anestésica"></textarea>
<textarea id="cond" placeholder="Conduta"></textarea>
</div>

<!-- ETAPA 6 -->
<div class="card">
<h3>Consentimento</h3>
<textarea id="consent">
Declaro que recebi explicações claras sobre a anestesia proposta, seus benefícios e riscos (como náuseas, dor, alergias ou complicações raras), alternativas e cuidados necessários. Tive oportunidade de esclarecer dúvidas e autorizo a realização da anestesia conforme avaliação médica.
</textarea>
</div>

<div class="card">
<h3>Anexos</h3>
<label>Foto do paciente</label>
<input type="file" id="foto">
<label>Via aérea</label>
<input type="file" id="via">
<label>Exames</label>
<input type="file" id="exames" multiple>
</div>

<div class="card">
<h3>Assinaturas</h3>
Paciente
<canvas id="sigPac" class="sig"></canvas>
<button class="btn-clear" onclick="limpar('sigPac')">Limpar</button>

Médico
<canvas id="sigMed" class="sig"></canvas>
<button class="btn-clear" onclick="limpar('sigMed')">Limpar</button>
</div>

<button class="btn-primary" onclick="gerarPDF()">Gerar PDF Premium</button>

</div>

<script>
const { jsPDF } = window.jspdf;

function limpar(id){
  const c=document.getElementById(id);
  const ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);
}

function ativarAssinatura(canvas){
  const ctx=canvas.getContext("2d");
  let desenhando=false;
  canvas.width=canvas.offsetWidth;
  canvas.height=canvas.offsetHeight;

  canvas.addEventListener("mousedown",()=>desenhando=true);
  canvas.addEventListener("mouseup",()=>desenhando=false);
  canvas.addEventListener("mousemove",e=>{
    if(!desenhando)return;
    ctx.lineWidth=2;
    ctx.lineCap="round";
    ctx.strokeStyle="black";
    ctx.lineTo(e.offsetX,e.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.offsetX,e.offsetY);
  });

  canvas.addEventListener("touchstart",()=>desenhando=true);
  canvas.addEventListener("touchend",()=>desenhando=false);
  canvas.addEventListener("touchmove",e=>{
    e.preventDefault();
    if(!desenhando)return;
    const rect=canvas.getBoundingClientRect();
    const x=e.touches[0].clientX-rect.left;
    const y=e.touches[0].clientY-rect.top;
    ctx.lineTo(x,y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x,y);
  });
}

ativarAssinatura(document.getElementById("sigPac"));
ativarAssinatura(document.getElementById("sigMed"));

async function gerarPDF(){
  const pdf=new jsPDF("p","mm","a4");

  const nome=nomeVal("nome");
  const proc=nomeVal("proc");
  const asa=nomeVal("asa");
  const mall=nomeVal("mallampati");

  const qrData=`Previa|${nome}|${Date.now()}`;
  const qr=await QRCode.toDataURL(qrData);

  pdf.setFillColor(20,45,85);
  pdf.rect(0,0,210,40,"F");
  pdf.setTextColor(255,255,255);
  pdf.setFontSize(22);
  pdf.text("Prévia",15,20);
  pdf.setFontSize(11);
  pdf.text("avaliação pré-anestésica",15,28);

  pdf.addImage(qr,"PNG",160,10,30,30);

  pdf.setTextColor(0,0,0);
  pdf.setFontSize(12);

  let y=50;

  function sec(titulo,conteudo){
    pdf.setFont(undefined,"bold");
    pdf.text(titulo,15,y);
    y+=6;
    pdf.setFont(undefined,"normal");
    pdf.text(conteudo||"-",15,y);
    y+=10;
  }

  sec("Paciente",nome);
  sec("Procedimento",proc);
  sec("ASA",asa);
  sec("Mallampati",mall);
  sec("Comorbidades",nomeVal("comorb"));
  sec("Medicações",nomeVal("medic"));
  sec("Alergias",nomeVal("alerg"));
  sec("Histórico cirúrgico",nomeVal("cirurg"));
  sec("Intercorrências anestésicas",nomeVal("interc"));
  sec("Plano anestésico",nomeVal("estrat"));
  sec("Conduta",nomeVal("cond"));
  sec("Consentimento",nomeVal("consent"));

  pdf.addPage();
  pdf.text("Assinaturas",15,20);

  pdf.addImage(document.getElementById("sigPac").toDataURL(),"PNG",15,30,80,40);
  pdf.text("Paciente",15,75);

  pdf.addImage(document.getElementById("sigMed").toDataURL(),"PNG",110,30,80,40);
  pdf.text("Médico",110,75);

  pdf.save("previa.pdf");
}

function nomeVal(id){
  return document.getElementById(id).value;
}
</script>
</body>
</html>