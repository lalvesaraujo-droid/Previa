<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prévia</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont;
background:linear-gradient(180deg,#0f2b46,#123a5c);
color:white;
}

.container{
max-width:480px;
margin:auto;
padding:20px;
}

.card{
background:rgba(255,255,255,0.08);
border-radius:20px;
padding:20px;
margin-bottom:20px;
backdrop-filter:blur(12px);
}

h1,h2{
margin:0 0 12px 0;
}

label{
font-size:13px;
opacity:0.8;
}

input,textarea,select{
width:100%;
padding:12px;
border-radius:12px;
border:none;
margin-top:6px;
margin-bottom:14px;
font-size:15px;
}

button{
width:100%;
padding:14px;
border-radius:14px;
border:none;
font-size:16px;
margin-top:10px;
}

.primary{background:#3b82f6;color:white;}
.secondary{background:rgba(255,255,255,0.15);color:white;}

.histItem{
background:rgba(255,255,255,0.1);
padding:12px;
border-radius:12px;
margin-bottom:10px;
cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<div id="homeTela">
<div class="card">
<h1>Prévia</h1>
<div style="opacity:0.7;font-size:13px;margin-bottom:10px">
Dr Leonardo Alves Araújo • CRM-MG 47310 • RQE 40542
</div>

<button class="primary" onclick="novaAvaliacao()">Nova avaliação</button>
<button class="secondary" onclick="abrirHistorico()">Histórico</button>
</div>
</div>

<!-- FORM -->
<div id="formTela" style="display:none">
<div class="card">
<h2>Nova avaliação</h2>

<label>Paciente</label>
<input id="paciente">

<label>Idade</label>
<input id="idade">

<label>ASA</label>
<select id="asa">
<option>I</option><option>II</option><option>III</option><option>IV</option>
</select>

<label>Procedimento</label>
<input id="procedimento">

<label>Comorbidades</label>
<textarea id="comorbidades"></textarea>

<label>Medicações</label>
<textarea id="medicacoes"></textarea>

<label>Via aérea (Mallampati)</label>
<select id="mallampati">
<option>I</option><option>II</option><option>III</option><option>IV</option>
</select>

<label>Estratégia anestésica</label>
<textarea id="estrategia"></textarea>

<label>Condição</label>
<input id="condicao" placeholder="Apto / Pendência">

<label>Conduta</label>
<textarea id="conduta"></textarea>

<label>Foto do paciente</label>
<input type="file" id="foto" accept="image/*">

<button class="primary" onclick="gerarResumo()">Gerar resumo</button>
<button class="secondary" onclick="irHome()">Voltar</button>

</div>
</div>

<!-- RESUMO -->
<div id="resumoTela" style="display:none">
<div class="card">
<h2>Resumo anestésico</h2>
<div id="textoResumo" style="white-space:pre-wrap;color:black;background:white;padding:14px;border-radius:12px"></div>

<button class="primary" onclick="gerarPDF()">Gerar PDF</button>
<button class="secondary" onclick="irHome()">Home</button>
</div>
</div>

<!-- HISTÓRICO -->
<div id="historicoTela" style="display:none">
<div class="card">
<h2>Histórico</h2>
<div id="listaHistorico"></div>
<button class="secondary" onclick="irHome()">Voltar</button>
</div>
</div>

</div>

<script>

function novaAvaliacao(){
document.getElementById("homeTela").style.display="none";
document.getElementById("formTela").style.display="block";
}

function irHome(){
document.getElementById("homeTela").style.display="block";
document.getElementById("formTela").style.display="none";
document.getElementById("resumoTela").style.display="none";
document.getElementById("historicoTela").style.display="none";
}

function gerarResumo(){

let dados={
paciente:paciente.value,
idade:idade.value,
asa:asa.value,
procedimento:procedimento.value,
comorbidades:comorbidades.value,
medicacoes:medicacoes.value,
mallampati:mallampati.value,
estrategia:estrategia.value,
condicao:condicao.value,
conduta:conduta.value
};

let texto=
`Paciente: ${dados.paciente}, ${dados.idade} anos, ASA ${dados.asa}
Procedimento: ${dados.procedimento}

Comorbidades: ${dados.comorbidades}
Medicações: ${dados.medicacoes}
Via aérea: Mallampati ${dados.mallampati}

Estratégia anestésica: ${dados.estrategia}

Condição: ${dados.condicao}
Conduta: ${dados.conduta}`;

textoResumo.innerText=texto;

salvarHistorico(dados);

document.getElementById("formTela").style.display="none";
document.getElementById("resumoTela").style.display="block";
}

function salvarHistorico(d){
let h=JSON.parse(localStorage.getItem("previaHist")||"[]");
h.unshift(d);
localStorage.setItem("previaHist",JSON.stringify(h));
}

function abrirHistorico(){
document.getElementById("homeTela").style.display="none";
document.getElementById("historicoTela").style.display="block";

let lista=document.getElementById("listaHistorico");
lista.innerHTML="";

let h=JSON.parse(localStorage.getItem("previaHist")||"[]");

h.forEach((d,i)=>{
let div=document.createElement("div");
div.className="histItem";
div.innerHTML=`${d.paciente} • ASA ${d.asa}<br><span style="opacity:0.6">${d.procedimento}</span>`;
div.onclick=()=>abrirItem(i);
lista.appendChild(div);
});
}

function abrirItem(i){
let h=JSON.parse(localStorage.getItem("previaHist")||"[]");
let d=h[i];

let texto=
`Paciente: ${d.paciente}, ${d.idade} anos, ASA ${d.asa}
Procedimento: ${d.procedimento}

Comorbidades: ${d.comorbidades}
Medicações: ${d.medicacoes}
Via aérea: Mallampati ${d.mallampati}

Estratégia anestésica: ${d.estrategia}

Condição: ${d.condicao}
Conduta: ${d.conduta}`;

textoResumo.innerText=texto;

document.getElementById("historicoTela").style.display="none";
document.getElementById("resumoTela").style.display="block";
}

async function gerarPDF(){

const { jsPDF } = window.jspdf;
let doc=new jsPDF();

let texto=document.getElementById("textoResumo").innerText;

doc.setFont("helvetica");
doc.setFontSize(14);
doc.text("Prévia — Avaliação Pré-anestésica",20,20);

doc.setFontSize(11);
doc.text("Dr Leonardo Alves Araújo • CRM-MG 47310 • RQE 40542",20,28);

doc.setFontSize(11);
doc.text(texto,20,40,{maxWidth:170});

doc.save("Previa.pdf");
}

</script>
</body>
</html>