<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prévia</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
font-family:Inter, sans-serif;
background:#0f2747;
margin:0;
padding:20px;
color:#1a1a1a;
}

.card{
background:#fff;
border-radius:18px;
padding:22px;
margin-bottom:16px;
box-shadow:0 10px 30px rgba(0,0,0,.12);
}

h1{margin:0;color:#0f2747}
h2{margin:10px 0 6px;color:#0f2747}
label{font-weight:600;font-size:14px}

input,textarea{
width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ccc;
margin-top:4px;
margin-bottom:10px;
font-size:14px;
}

button{
background:#1f4f9b;
color:white;
border:none;
padding:14px;
border-radius:12px;
font-size:16px;
width:100%;
margin-top:10px;
}

.logo{
text-align:center;
margin-bottom:10px;
}

.logo img{
width:90px;
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<div class="card logo">
<img src="logo_previa.png">
<h1>Prévia</h1>
<div>plataforma de avaliação pré-anestésica</div>
</div>

<div class="card">
<h2>Paciente</h2>
<input id="nome" placeholder="Nome">
<input id="proced" placeholder="Procedimento">
<input id="asa" placeholder="ASA">
<input id="mall" placeholder="Mallampati">
</div>

<div class="card">
<h2>Dados clínicos</h2>
<textarea id="comorb" placeholder="Comorbidades"></textarea>
<textarea id="meds" placeholder="Medicações"></textarea>
<textarea id="alerg" placeholder="Alergias"></textarea>
<textarea id="cirurg" placeholder="Passado cirúrgico"></textarea>
<textarea id="interc" placeholder="Intercorrências anestésicas"></textarea>
</div>

<div class="card">
<h2>Estratégia</h2>
<textarea id="estrat" placeholder="Estratégia anestésica"></textarea>
<textarea id="cond" placeholder="Conduta"></textarea>
</div>

<div class="card">
<h2>Consentimento</h2>
<textarea id="consent"></textarea>
</div>

<div class="card">
<h2>Anexos</h2>
<label>Via aérea</label>
<input type="file" id="fotoVia">
<label>Exames</label>
<input type="file" id="exames" multiple>
</div>

<button onclick="gerarPDF()">Gerar PDF final</button>

<script>
async function gerarPDF(){

const { jsPDF } = window.jspdf;
const pdf = new jsPDF("p","mm","a4");

const nome = document.getElementById("nome").value;
const proced = document.getElementById("proced").value;
const asa = document.getElementById("asa").value;
const mall = document.getElementById("mall").value;
const comorb = document.getElementById("comorb").value;
const meds = document.getElementById("meds").value;
const alerg = document.getElementById("alerg").value;
const cirurg = document.getElementById("cirurg").value;
const interc = document.getElementById("interc").value;
const estrat = document.getElementById("estrat").value;
const cond = document.getElementById("cond").value;
let consent = document.getElementById("consent").value;

if(!consent){
consent =
"Declaro ter sido informado(a) sobre a anestesia proposta, riscos, benefícios, alternativas e cuidados perioperatórios. " +
"Autorizo a realização da anestesia pelo Dr. Leonardo Alves Araújo CRM-MG 47310 RQE 40542.";
}

function bloco(titulo,txt){
pdf.setFont("helvetica","bold");
pdf.text(titulo,20,y);
y+=6;
pdf.setFont("helvetica","normal");
const linhas = pdf.splitTextToSize(txt,170);
pdf.text(linhas,20,y);
y+=linhas.length*6+2;
}

let y = 20;

/* CAPA */
pdf.setFillColor(15,39,71);
pdf.rect(0,0,210,60,"F");
pdf.setTextColor(255,255,255);
pdf.setFontSize(22);
pdf.text("Prévia",20,25);
pdf.setFontSize(11);
pdf.text("plataforma de avaliação pré-anestésica",20,32);
pdf.text("RT: Dr. Leonardo Alves Araújo",20,40);
pdf.text("CRM-MG 47310 • RQE 40542",20,46);

pdf.setTextColor(0,0,0);
y=70;

/* RESUMO */
pdf.setFontSize(14);
pdf.setFont("helvetica","bold");
pdf.text(nome,20,y); y+=6;
pdf.setFont("helvetica","normal");
pdf.text(proced,20,y); y+=6;
pdf.text("ASA "+asa+"   Mallampati "+mall,20,y); y+=10;

pdf.setFont("helvetica","bold");
pdf.text("Dados clínicos",20,y); y+=6;
pdf.setFont("helvetica","normal");
pdf.text(comorb,20,y); y+=6;
pdf.text(meds,20,y); y+=6;
pdf.text(alerg,20,y); y+=6;
pdf.text(cirurg,20,y); y+=6;
pdf.text(interc,20,y); y+=10;

/* ESTRATÉGIA */
pdf.setFont("helvetica","bold");
pdf.text("Estratégia anestésica",20,y); y+=6;
pdf.setFont("helvetica","normal");
pdf.text(estrat,20,y); y+=8;

pdf.setFont("helvetica","bold");
pdf.text("Conduta",20,y); y+=6;
pdf.setFont("helvetica","normal");
pdf.text(cond,20,y); y+=10;

/* CONSENTIMENTO */
pdf.setFont("helvetica","bold");
pdf.text("Consentimento informado",20,y); y+=6;
pdf.setFont("helvetica","normal");
const c = pdf.splitTextToSize(consent,170);
pdf.text(c,20,y);

/* ANEXOS */
const foto = document.getElementById("fotoVia").files[0];
const exames = document.getElementById("exames").files;

if(foto || exames.length){
pdf.addPage();
pdf.setFontSize(16);
pdf.text("Anexos",20,20);

let y2=30;

if(foto){
const img = await readImg(foto);
pdf.text("Via aérea",20,y2);
pdf.addImage(img,"JPEG",20,y2+4,60,60);
y2+=70;
}

if(exames.length){
pdf.text("Exames",20,y2);
y2+=6;
for(let i=0;i<exames.length;i++){
const img = await readImg(exames[i]);
const x = 20+(i%3)*60;
const yy = y2+Math.floor(i/3)*60;
pdf.addImage(img,"JPEG",x,yy,50,50);
}
}
}

pdf.save("Previa_"+nome+".pdf");
}

function readImg(file){
return new Promise(res=>{
const r = new FileReader();
r.onload=e=>res(e.target.result);
r.readAsDataURL(file);
});
}
</script>

</body>
</html>