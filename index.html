<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prévia</title>
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div class="app">

<header class="header">
  <h1>Prévia</h1>
  <div class="sub">
    Dr Leonardo Alves Araújo • CRM-MG 47310 • RQE 40542
  </div>
</header>

<!-- HOME -->
<div class="card" id="screenHome">
  <h2>Home</h2>

  <button class="btn btnPrimary" onclick="goNew()">
    Nova avaliação
  </button>

  <button class="btn btnGhost" onclick="goHistory()">
    Histórico
  </button>
</div>

<!-- FORM -->
<div class="card" id="screenForm" style="display:none">

<h2>Nova avaliação</h2>

<label>Paciente</label>
<input id="nome">

<label>Idade</label>
<input id="idade">

<label>ASA</label>
<select id="asa">
<option>I</option>
<option>II</option>
<option>III</option>
<option>IV</option>
</select>

<label>Procedimento</label>
<input id="procedimento">

<label>Comorbidades</label>
<textarea id="comorb"></textarea>

<label>Medicações</label>
<textarea id="medic"></textarea>

<label>Via aérea (Mallampati)</label>
<select id="mallampati">
<option>I</option>
<option>II</option>
<option>III</option>
<option>IV</option>
</select>

<label>Estratégia anestésica</label>
<textarea id="estrategia"></textarea>

<label>Condição</label>
<input id="condicao" placeholder="Apto / Pendência">

<label>Conduta</label>
<textarea id="conduta"></textarea>

<label>Foto do paciente</label>
<input type="file" id="foto" accept="image/*">

<div class="btnRow">
  <button class="btn btnPrimary" onclick="salvar()">
    Salvar
  </button>

  <button class="btn btnGhost" onclick="goHome()">
    Voltar
  </button>
</div>

</div>

<!-- HISTÓRICO -->
<div class="card" id="screenHistory" style="display:none">

<h2>Histórico</h2>

<div id="historyList"></div>

<div class="btnRow">
  <button class="btn btnGhost" onclick="goHome()">
    Home
  </button>

  <button class="btn btnDanger" onclick="clearHistory()">
    Apagar tudo
  </button>
</div>

</div>

</div>

<script>

function goHome(){
  screenHome.style.display="block"
  screenForm.style.display="none"
  screenHistory.style.display="none"
}

function goNew(){
  screenHome.style.display="none"
  screenForm.style.display="block"
  screenHistory.style.display="none"
}

function goHistory(){
  screenHome.style.display="none"
  screenForm.style.display="none"
  screenHistory.style.display="block"
  loadHistory()
}

function salvar(){

const data = {
nome:nome.value,
idade:idade.value,
asa:asa.value,
procedimento:procedimento.value,
comorb:comorb.value,
medic:medic.value,
mallampati:mallampati.value,
estrategia:estrategia.value,
condicao:condicao.value,
conduta:conduta.value
}

let lista = JSON.parse(localStorage.getItem("previa")||"[]")
lista.push(data)
localStorage.setItem("previa",JSON.stringify(lista))

alert("Avaliação salva")
goHome()
}

function loadHistory(){

let lista = JSON.parse(localStorage.getItem("previa")||"[]")

historyList.innerHTML=""

lista.forEach((it,i)=>{

historyList.innerHTML+=`
<div class="histItem">
<b>${it.nome}</b><br>
ASA ${it.asa} • ${it.procedimento}<br>
<button onclick="ver(${i})">Abrir</button>
</div>
`

})
}

function ver(i){

let lista = JSON.parse(localStorage.getItem("previa")||"[]")
let it = lista[i]

alert(
"Paciente: "+it.nome+"\n"+
"ASA: "+it.asa+"\n"+
"Procedimento: "+it.procedimento+"\n"+
"Estratégia: "+it.estrategia
)
}

function clearHistory(){
localStorage.removeItem("previa")
loadHistory()
}

</script>

</body>
</html>